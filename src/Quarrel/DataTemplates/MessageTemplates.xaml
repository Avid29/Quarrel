<ResourceDictionary
    x:Class="Quarrel.DataTemplates.MessageTemplates"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:tc="using:Microsoft.Toolkit.Uwp.UI.Controls"
    xmlns:mconvert="using:Quarrel.Converters.DataTemplates.Messages"
    xmlns:tconvert="using:Quarrel.Converters.Time"
    xmlns:qc="using:Quarrel.Controls"
    xmlns:bindablemessages="using:Quarrel.Bindables.Messages"
    xmlns:bindableembeds="using:Quarrel.Bindables.Messages.Embeds"
    xmlns:markdown="using:Quarrel.Markdown"
    xmlns:converters="using:Quarrel.Converters">

    <DataTemplate x:Key="DefaultMessageTemplate" x:DataType="bindablemessages:BindableMessage">
        <Grid Padding="2,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="64"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!--Image-->
            <Border x:Name="ProfileImageContainer"  Width="36" Height="36"
                    CornerRadius="18" VerticalAlignment="Top" x:Load="{x:Bind converters:InverseBoolConverter.Convert(IsContinuation), Mode=OneWay}">
                <tc:ImageEx Source="{x:Bind Author.AvatarUri}"/>
            </Border>

            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto"/>
                    <RowDefinition/>
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" Margin="0,-4,0,0" x:Name="UsernameContainer"  x:Load="{x:Bind converters:InverseBoolConverter.Convert(IsContinuation), Mode=OneWay}">
                    <HyperlinkButton Content="{x:Bind Author.User.Username}" Style="{StaticResource PlainTextHyperlinkStyle}"
                                     FontSize="14"/>
                    <TextBlock Text="{x:Bind tconvert:SmartTimeFormatConverter.Convert(Message.Timestamp)}"
                               VerticalAlignment="Center"
                               FontSize="11" Opacity=".5" Margin="6,0"/>
                </StackPanel>

                <StackPanel Grid.Row="1">
                    <markdown:MessageRenderer Text="{x:Bind Content, Mode=OneWay}"
                                              Context="{x:Bind}" Grid.Row="1"
                                              HorizontalAlignment="Left"/>

                    <ItemsControl ItemsSource="{x:Bind Attachments}"
                                  HorizontalAlignment="Left">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="bindableembeds:BindableAttachment">
                                    <tc:ImageEx Source="{x:Bind Attachment.ProxyUrl}" MaxWidth="400"
                                                CornerRadius="2"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Grid>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="InfoMessageTemplate" x:DataType="bindablemessages:BindableMessage">
        <Grid VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="64"/>
                <ColumnDefinition Width="auto"/>
                <ColumnDefinition Width="auto"/>
            </Grid.ColumnDefinitions>
            <FontIcon Glyph="{x:Bind mconvert:InfoMessageIconConverter.Convert(Message.Type)}"
                      Foreground="{x:Bind mconvert:InfoMessageColorConverter.Convert(Message.Type)}"/>

            <markdown:MessageRenderer Grid.Column="1" Margin="0,-5,0,0" Context="{x:Bind}" HorizontalAlignment="Left"
                                      Text="{x:Bind mconvert:InfoMessageContentConverter.Convert((bindablemessages:BindableMessage))}"/>

            <TextBlock Grid.Column="2" Text="{x:Bind tconvert:SmartTimeFormatConverter.Convert(Message.Timestamp)}"
                       Opacity=".5" Margin="8,0"/>
        </Grid>
    </DataTemplate>

</ResourceDictionary>
